name: Keep Balance Sim Awake

on:
  schedule:
    - cron: '0 */4 * * *'  # UTC 매 4시간 (KST 오후 1/5/9/1시)
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install Selenium
        run: pip install selenium webdriver-manager
      - name: Wake app with Selenium
        run: |
          python -c "
          from selenium import webdriver
          from selenium.webdriver.chrome.options import Options
          from selenium.webdriver.common.by import By
          from selenium.webdriver.support.ui import WebDriverWait
          from selenium.webdriver.support import expected_conditions as EC
          from selenium.common.exceptions import TimeoutException
          import time

          options = Options()
          options.add_argument('--headless')
          options.add_argument('--no-sandbox')
          options.add_argument('--disable-dev-shm-usage')
          options.add_argument('--disable-gpu')
          options.add_argument('--window-size=1920,1080')

          driver = webdriver.Chrome(options=options)
          driver.get('https://gartist082-balance-sim-demo.streamlit.app')
          time.sleep(5)

          wait = WebDriverWait(driver, 10)
          try:
              buttons = [
                  '//button[contains(text(), \"Rerun\")]',
                  '//button[contains(text(), \"Wake up\") or contains(text(), \"앱 깨우기\")]',
                  '//button[@data-testid=\"baseButton-primary\"]',
                  '//button[contains(@class, \"stButton\")]',
                  '//*[text()=\"Rerun\" or text()=\"Run\"]'
              ]
              clicked = False
              for xpath in buttons:
                  try:
                      btn = wait.until(EC.element_to_be_clickable((By.XPATH, xpath)))
                      btn.click()
                      print(f'✅ Clicked button with xpath: {xpath}')
                      clicked = True
                      break
                  except TimeoutException:
                      continue
              if not clicked:
                  print('❌ No wake button found, app may already be awake')
          except Exception as e:
              print(f'Error: {e}')
          finally:
              driver.quit()
          "
